<template>
	<header class="kkwtjztg">
	  <div class="user-info">
		<div>
		  <MkA
			v-user-preview="note.user.id"
			class="name"
			:to="userPage(note.user)"
			@click.stop
		  >
			<MkUserName :user="note.user" class="mkusername">
			  <span v-if="note.user.isBot" class="is-bot">bot</span>
			</MkUserName>
		  </MkA>
		  <div class="username"><MkAcct :user="note.user" /></div>
  
		  <span v-if="isAdmin" v-tooltip.noDelay="'Verificado'" class="check-icon">
			<i :class="icon('ph-bold ph-seal-check')"></i>
		  </span>
		</div>
  
		<div>
		  <div class="info">
			<MkA class="created-at" :to="notePage(note)">
			  <MkTime v-if="note.scheduledAt != null" :time="note.scheduledAt"/>
			  <MkTime v-else :time="note.createdAt" />
			  <i
				v-if="note.updatedAt"
				v-tooltip.noDelay="
				  i18n.t('edited', {
					date: new Date(
					  note.updatedAt,
					).toLocaleDateString(),
					time: new Date(
					  note.updatedAt,
					).toLocaleTimeString(),
				  })
				"
				:class="icon('ph-pencil', false)"
				style="margin-inline-start: 0.4rem"
			  ></i>
			</MkA>
			<MkVisibility :note="note" />
		  </div>
		  <MkInstanceTicker
			v-if="showTicker"
			class="ticker"
			:instance="note.user.instance"
			@click.stop="openServerInfo"
		  />
		</div>
	  </div>
	</header>
  </template>
  
  <script lang="ts" setup>
  import type { entities } from "fedired-js";
  import { defaultStore } from "@/store";
  import MkVisibility from "@/components/MkVisibility.vue";
  import MkInstanceTicker from "@/components/MkInstanceTicker.vue";
  import { notePage } from "@/filters/note";
  import { userPage } from "@/filters/user";
  import { i18n } from "@/i18n";
  import { pageWindow } from "@/os";
  import icon from "@/scripts/icon";
  import { me, isSignedIn } from "@/me";
  
  const props = defineProps<{
	note: entities.Note;
	pinned?: boolean;
	canOpenServerInfo?: boolean;
  }>();
  
  const isAdmin = computed(() => props.note.user.isAdmin && props.note.user.username === 'srnovus');
  const isModerator = computed(() => props.note.user.isModerator && props.note.user.username === 'fedired');
  
  const showTicker =
	defaultStore.state.instanceTicker === "always" ||
	(defaultStore.state.instanceTicker === "remote" && props.note.user.instance);
  
  function openServerInfo() {
	if (!props.canOpenServerInfo || !defaultStore.state.openServerInfo) return;
	if (props.note.user.host != null && !isSignedIn(me)) return;
  
	const instanceInfoUrl =
	  props.note.user.host == null
		? "/about"
		: `/instance-info/${props.note.user.host}`;
	pageWindow(instanceInfoUrl);
  }
  </script>
  
  <style scoped>
  .kkwtjztg {
	position: relative;
	z-index: auto;
	display: flex;
	align-items: center;
	white-space: nowrap;
	justify-self: auto;
	border-radius: 100px;
	font-size: 0.8em;
	> .avatar {
	  width: 3.7em;
	  height: 3.7em;
	  margin-right: 1em;
	}
	> .user-info {
	  width: 0;
	  flex-grow: 1;
	  line-height: 1.5;
	  display: flex;
	  font-size: 1.2em;
	  > div {
		&:first-child {
		  flex-grow: 1;
		  width: 0;
		  overflow: hidden;
		  text-overflow: ellipsis;
		  gap: 0.1em 0;
		}
		&:last-child {
		  max-width: 50%;
		  gap: 0.3em 0.5em;
		}
	  }
	}
  }
  
  .username {
	display: inline;
	margin: 0 0.5em 0 0;
	overflow: hidden;
	text-overflow: ellipsis;
	align-self: flex-start;
	font-size: 1em; 
  }
  
  .check-icon {
	color: var(--badge);
	margin-left: 4px;
	font-size: 1em; 
	vertical-align: middle; 
  }
  
  .check-icon i {
	font-size: inherit; 
  }
  </style>
  